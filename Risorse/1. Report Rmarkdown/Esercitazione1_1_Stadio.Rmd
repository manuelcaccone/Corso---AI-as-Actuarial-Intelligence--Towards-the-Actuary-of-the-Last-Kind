---
title: "Report Trimestrale Portafoglio Polizze Auto"
subtitle: "Q3 2024 - Analisi Performance e Sinistralità"
author: "Direzione Tecnica Assicurazioni"
date: "15 Ottobre 2024"
output: 
  word_document:
    toc: true
    toc_depth: 2
    fig_caption: true
    fig_width: 7
    fig_height: 5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(ggplot2)
library(dplyr)
library(knitr)
library(formattable)
library(reshape2)

# Creazione dati statici fissi per Q3 2024
dati_q3 <- data.frame(
  mese = c("Luglio", "Agosto", "Settembre"),
  premi_raccolti = c(920000, 890000, 990000),
  sinistri_pagati = c(610000, 595000, 695000),
  n_polizze = c(14800, 14900, 15200),
  n_sinistri = c(385, 370, 425),
  stringsAsFactors = FALSE
)

# Dati per fasce d'età (statici)
dati_eta <- data.frame(
  fascia_eta = c("18-25", "26-35", "36-50", "51-65", "65+"),
  n_polizze = c(1200, 3800, 5200, 3500, 1500),
  sinistri = c(148, 342, 416, 245, 129),
  premio_medio = c(850, 720, 650, 580, 520),
  stringsAsFactors = FALSE
)

# Dati geografici (statici)
dati_geografici <- data.frame(
  regione = c("Nord", "Centro", "Sud"),
  n_polizze = c(6800, 4200, 4200),
  sinistri = c(476, 315, 389),
  premio_medio = c(680, 720, 590),
  stringsAsFactors = FALSE
)

# Calcoli KPI fissi
totale_premi_q3 <- sum(dati_q3$premi_raccolti)
totale_sinistri_q3 <- sum(dati_q3$sinistri_pagati)
loss_ratio_q3 <- round((totale_sinistri_q3 / totale_premi_q3) * 100, 1)
frequenza_q3 <- round((sum(dati_q3$n_sinistri) / mean(dati_q3$n_polizze)) * 100, 1)
costo_medio_q3 <- round(totale_sinistri_q3 / sum(dati_q3$n_sinistri), 0)

# Dati Q2 2024 per confronto (statici)
totale_premi_q2 <- 2650000
totale_sinistri_q2 <- 1695000
loss_ratio_q2 <- 63.9
frequenza_q2 <- 7.8
```

# Executive Summary

Il portafoglio polizze auto ha chiuso il Q3 2024 con **€2.800.000** di premi raccolti e **€1.900.000** di sinistri pagati, registrando un **loss ratio del 67.8%**. 

**Indicatori chiave Q3 2024:**
- **Premi raccolti**: €2.800.000 (+5.7% vs Q2)
- **Loss Ratio**: 67.8% (+3.9 punti vs Q2)  
- **Frequenza sinistri**: 8.2% (+0.4 punti vs Q2)
- **Costo medio sinistro**: €1.630 (+€95 vs Q2)
- **Numero polizze attive**: 15.200 (+3.2% vs Q2)

**Alert**: Il loss ratio ha superato la soglia target del 65%, principalmente a causa dell'aumento del costo medio sinistro nel mese di settembre.

# Analisi della Performance Mensile

```{r grafico-trend-mensile, fig.cap="Andamento Mensile Premi e Sinistri Q3 2024"}
# Grafico trend mensile (codice statico)
dati_long <- reshape2::melt(dati_q3[,c("mese", "premi_raccolti", "sinistri_pagati")], 
                           id.vars = "mese")

ggplot(dati_long, aes(x = factor(mese, levels = c("Luglio", "Agosto", "Settembre")), 
                      y = value, 
                      fill = variable)) +
  geom_bar(stat = "identity", position = "dodge", alpha = 0.8) +
  scale_fill_manual(values = c("#2E86AB", "#A43820"), 
                    labels = c("Premi Raccolti", "Sinistri Pagati")) +
  scale_y_continuous(labels = function(x) paste0("€", format(x/1000, big.mark = ".", decimal.mark = ","), "K")) +
  labs(title = "Trend Mensile Premi vs Sinistri",
       x = "Mese", 
       y = "Importo (€K)",
       fill = "Tipologia") +
  theme_minimal() +
  theme(legend.position = "bottom")
```

Il mese di **settembre** ha mostrato il peggior performance con un loss ratio del 70.2%, influenzato dall'aumento stagionale degli incidenti.

```{r tabella-mensile}
# Tabella dettagliata mensile
tab_mensile <- dati_q3 %>%
  mutate(
    loss_ratio = round((sinistri_pagati / premi_raccolti) * 100, 1),
    frequenza = round((n_sinistri / n_polizze) * 100, 1),
    costo_medio = round(sinistri_pagati / n_sinistri, 0)
  ) %>%
  select(
    Mese = mese,
    `Premi (€)` = premi_raccolti,
    `Sinistri (€)` = sinistri_pagati,
    `N° Polizze` = n_polizze,
    `N° Sinistri` = n_sinistri,
    `Loss Ratio (%)` = loss_ratio,
    `Frequenza (%)` = frequenza,
    `Costo Medio (€)` = costo_medio
  )

kable(tab_mensile, 
      caption = "Dettaglio Performance Mensile Q3 2024",
      format.args = list(big.mark = ".", decimal.mark = ","),
      align = c("l", rep("r", 7)))
```

# Analisi per Fascia d'Età

```{r grafico-eta, fig.cap="Distribuzione Loss Ratio per Fascia d'Età"}
# Calcolo loss ratio per età (dati statici)
dati_eta_analisi <- dati_eta %>%
  mutate(
    frequenza = round((sinistri / n_polizze) * 100, 1),
    premi_totali = n_polizze * premio_medio,
    sinistri_totali = sinistri * 1630,  # costo medio fisso
    loss_ratio = round((sinistri_totali / premi_totali) * 100, 1)
  )

ggplot(dati_eta_analisi, aes(x = fascia_eta, y = loss_ratio, fill = fascia_eta)) +
  geom_col(alpha = 0.8, show.legend = FALSE) +
  geom_hline(yintercept = 65, color = "red", linetype = "dashed", size = 1) +
  geom_text(aes(label = paste0(loss_ratio, "%")), vjust = -0.5, fontface = "bold") +
  scale_fill_brewer(type = "qual", palette = "Set2") +
  labs(title = "Loss Ratio per Fascia d'Età",
       subtitle = "Linea rossa: target 65%",
       x = "Fascia d'Età", 
       y = "Loss Ratio (%)") +
  theme_minimal() +
  ylim(0, max(dati_eta_analisi$loss_ratio) * 1.1)
```

**Criticità identificate:**
- Fascia 18-25 anni: loss ratio critico al 75.3% (10+ punti sopra target)
- Fascia 26-35 anni: loss ratio al 68.9% (quasi 4 punti sopra target)
- Necessario rivedere pricing per fasce giovani

```{r tabella-eta}
tab_eta <- dati_eta_analisi %>%
  select(
    `Fascia Età` = fascia_eta,
    `N° Polizze` = n_polizze,
    `N° Sinistri` = sinistri,
    `Premio Medio (€)` = premio_medio,
    `Frequenza (%)` = frequenza,
    `Loss Ratio (%)` = loss_ratio
  )

kable(tab_eta, 
      caption = "Analisi Dettagliata per Fascia d'Età",
      format.args = list(big.mark = ".", decimal.mark = ","),
      align = c("l", rep("r", 5)))
```

# Analisi Geografica

```{r grafico-geografico, fig.cap="Performance per Area Geografica"}
dati_geo_analisi <- dati_geografici %>%
  mutate(
    frequenza = round((sinistri / n_polizze) * 100, 1),
    premi_totali = n_polizze * premio_medio,
    sinistri_totali = sinistri * 1630,
    loss_ratio = round((sinistri_totali / premi_totali) * 100, 1)
  )

ggplot(dati_geo_analisi, aes(x = reorder(regione, -loss_ratio), y = loss_ratio, fill = regione)) +
  geom_col(alpha = 0.8, show.legend = FALSE) +
  geom_hline(yintercept = 65, color = "red", linetype = "dashed", size = 1) +
  geom_text(aes(label = paste0(loss_ratio, "%")), vjust = -0.5, fontface = "bold") +
  scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73")) +
  labs(title = "Loss Ratio per Area Geografica",
       subtitle = "Linea rossa: target 65%",
       x = "Regione", 
       y = "Loss Ratio (%)") +
  theme_minimal()
```

Il **Sud Italia** presenta la performance migliore con loss ratio al 60.8%, mentre il **Centro** mostra criticità al 71.2%.

# Confronto con Q2 2024

```{r confronto-trimestrale}
confronto <- data.frame(
  Indicatore = c("Premi Raccolti (€M)", "Sinistri Pagati (€M)", "Loss Ratio (%)", 
                 "Frequenza (%)", "Costo Medio (€)", "N° Polizze"),
  Q2_2024 = c("2.65", "1.70", "63.9", "7.8", "1,535", "14,700"),
  Q3_2024 = c("2.80", "1.90", "67.8", "8.2", "1,630", "15,200"),
  Variazione = c("+5.7%", "+11.8%", "+3.9pp", "+0.4pp", "+€95", "+3.4%"),
  stringsAsFactors = FALSE
)

kable(confronto, 
      caption = "Confronto Performance Q2 vs Q3 2024",
      col.names = c("Indicatore", "Q2 2024", "Q3 2024", "Variazione"),
      align = c("l", "r", "r", "r"))
```

**Trend preoccupanti:**
- Aumento significativo sinistri pagati (+11.8%)
- Deterioramento loss ratio (+3.9 punti percentuali)
- Crescita contenuta premi vs sinistri

# Proiezioni Q4 2024

Basandosi sui trend Q3, si prevede per Q4 2024:
- **Premi stimati**: €2.95M (+5% vs Q3)
- **Loss ratio target**: 66% (miglioramento per azioni correttive)
- **Sinistri stimati**: €1.95M

**Raccomandazioni strategiche:**

1. **Revisione Pricing**: Incremento tariffe fasce 18-35 anni del 8-12%
2. **Geografica**: Analisi approfondita mercato Centro Italia
3. **Prevenzione**: Programma bonus sicurezza stradale
4. **Monitoraggio**: KPI settimanali su settembre per identificare early warning

---

*Report generato il `r format(Sys.Date(), "%d/%m/%Y")` - Prossimo aggiornamento: 15 Gennaio 2025*